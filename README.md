# A different weather report
#### Video Demo: https://youtu.be/c_1lX8TzztU
## Description:
This project is a dynamic, database-driven weather website built with Flask, SQLite, and Bootstrap. It provides weather information, AI-generated weather reports in multiple creative styles, and a personalized user experience. The site is designed to be both informative and engaging, offering users not only the latest weather data for major cities around the world but also unique, stylized weather reports generated by the large language model (LLM) Google Gemini.

### Personal learning goals

Although any programming language could be used, I decided to stick to Python. Python I learned in the CS50 course and the final project seemed like an excellent way to test my newly acquired skill. I also wanted to try make something dry (like the weather) into something funny (Pirate style weather) and more practical (Fashion advice).

### Getting Started
1. Clone the repository.
2. Install dependencies (`pip install -r requirements.txt`).
3. Set up your `.env` file with the required API keys.
4. Run the database initialization script (`python db_init.py`).
5. Start the Flask app (`python app.py`).
6. Visit `http://localhost:5000` in your browser.

### Key Functionalities

#### 1. Real-Time Weather Data
- The sites fetches current weather and hourly forecasts of the user's current location.
- The site fetches current weather and hourly forecasts from the open-meteo.com API for 10 major cities (Vancouver, New York, London, Tokyo, Sydney, Paris, Cairo, Rio de Janeiro, Moscow, Mumbai).
- Weather data includes temperature, wind speed and direction (with cardinal and Beaufort scale), humidity, pressure, and weather codes.
- Weather icons are mapped to each condition for quick visual reference.

#### 2. AI-Generated Weather Reports
- The site integrates with Google Gemini to generate weather reports in multiple creative styles.
- Styles include: Normal Weather Report, Shakespearean, Children’s Storybook, Pirate, and Fashion Advice.
- Reports are generated using a carefully crafted prompt that enforces a consistent structure: headline, TLDR summary (if morning), summary-so-far (if not morning), and detailed period sections (morning, afternoon, evening).
- The AI output is formatted in HTML with semantic tags for easy styling and readability.

#### 3. User Accounts and Personalization
- Users can register, log in, and log out using secure authentication (passwords are hashed).
- Logged-in users can generate and view custom weather reports in any available style for any city.
- Each user’s generated reports are stored in the database for caching and eventually allowing for personalized history.
- Guest users can view the default weather report but must log in to access other styles.

#### 4. Database-Driven Design
- All city and style data is stored in a SQLite database, populated from a configuration file.
- Weather reports are cached in the database, reducing redundant API and LLM calls.
- The `weather_reports` table is linked to the `users` table, allowing reports to be associated with specific users or left anonymous for guests.

#### 5. Modern, Responsive UI
- The site uses Bootstrap 5 for a mobile-friendly layout.
- Weather icons are displayed using a custom SVG icon set, mapped to open-meteo weather codes.
- The homepage features a carousel for the user’s 24-hour forecast and tabbed content for city weather reports in different styles.
- Flash messages provide user feedback for actions like login and registration.

## How It Works

1. **Homepage:**
   - Displays the user’s location and a 24-hour forecast carousel if location data is available.
   - Shows a list of major cities with current weather and icons.
   - Allows users to select a city to generate a custom weather report.

2. **City Page:**
   - For each city, shows current weather, a 24-hour forecast, and a tabbed interface for different report styles.
   - The default tab displays the normal weather report. 
   - Other tabs allow logged-in users to generate reports in creative styles. Only visible when logged in!
   - 'Help' tab to explain how it works.

3. **User Authentication:**
   - Users can register and log in to access all report styles.
   - Session management is handled securely with Flask-Session.

4. **Weather Report Generation:**
   - Guest users see a auto generated weather report
   - When a user requests a report, the site checks the database for a cached version.
   - If not found, it fetches fresh weather data and calls the LLM to generate a new report, which is then cached.
   - Logged in users can generate reports for different styles.
   - For consistency a report has some hard rules regarding the time of the day (Morning, Midday, Evening and Night)

5. **Database setup:**
   - A config.json file is provided that contains the cities (including coordinates and timezone) and the available styles.
   - A db_init.py scripts create the database, various tables and inserts the data from the config file.

### Project File Overview
   - app.py: The main Flask application. Handles routing, user authentication, weather data fetching, report generation, and rendering templates.
   - helpers.py: Contains utility functions for weather API calls, AI prompt construction, user location, and formatting.
   - weather_helper.py: Maps weather codes to icons and descriptions, and provides functions for processing and grouping weather data.
   - db_init.py: Initializes the SQLite database, creates tables, and populates cities and styles from config.json.
   - config.json: Stores city and style configuration data.
   - templates/: Contains all Jinja2 HTML templates for the site, including layout.html (base template), index.html (homepage), city.html (city weather page), login.html, and register.html.
   - static/: Contains static assets such as CSS, JS, and SVG weather icons.

### Design Decisions
   - Framework Choice: Flask was chosen because I used it in the problem sets. It's used for handling routing, session, redirect and creating URLs.
   - Database: SQLite provides a lightweight, file-based database that is easy to set up and maintain for small to medium projects.
   - Caching: Weather reports are cached in the database to minimize API and LLM calls, improving performance and reducing costs.
   - User Management: User authentication is implemented with hashed passwords and session management for security and personalization.
   - Prompt Engineering: The AI prompt is modular, with style instructions managed in Python for maintainability and consistency.
   - UI/UX: Bootstrap 5 ensures a responsive, modern interface. Tabbed content and carousels enhance usability.
   - Extensibility: The project is designed to be easily extended with new cities or styles thanks to its configuration-based setup.

### Challenges and Future Improvements
   - Integrating the LLM required careful prompt engineering to ensure consistent, high-quality output.
   - Handling timezones turned out to be fairly easy as the Open Meteo API allows for a timezone option. In earlier versions I did not store the cities timezone which made gave sunny weather in the middle of the night.
   - Future improvements could include user profile pages, more granular weather data, additional report styles, and admin tools for managing cities and styles.
   - The fashion report can be more personalised with users preference to colors, fabrics and overall preferred style.

### Technologies Used
- Python 3
- Flask
- SQLite
- Bootstrap 5
- Google Gemini (google-generativeai)
- open-meteo.com API
- Flask-Session
- Jinja2 Templates

### Third Party Tools
- Bootstrap 5: https://getbootstrap.com/
- AI for writing weather reports (Google Gemini): https://ai.google.dev/
- Carousel Hourly Forecast: https://swiperjs.com/
- Weather Icons 1: https://erikflowers.github.io/weather-icons/
- Weather Icons 2: https://github.com/Makin-Things/weather-icons